var Te=Object.defineProperty,Me=Object.defineProperties;var Oe=Object.getOwnPropertyDescriptors;var ve=Object.getOwnPropertySymbols;var Ve=Object.prototype.hasOwnProperty,Le=Object.prototype.propertyIsEnumerable;var Ae=(r,d,a)=>d in r?Te(r,d,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[d]=a,A=(r,d)=>{for(var a in d||(d={}))Ve.call(d,a)&&Ae(r,a,d[a]);if(ve)for(var a of ve(d))Le.call(d,a)&&Ae(r,a,d[a]);return r},J=(r,d)=>Me(r,Oe(d));var V=(r,d,a)=>new Promise((b,p)=>{var y=R=>{try{u(a.next(R))}catch(P){p(P)}},w=R=>{try{u(a.throw(R))}catch(P){p(P)}},u=R=>R.done?b(R.value):Promise.resolve(R.value).then(y,w);u((a=a.apply(r,d)).next())});import{bI as je,bJ as $e,bK as De,j as B,N as e,bL as pe,bM as he,m as _e,p as Ee,d as re,bN as We,bO as Ne,bP as q,bm as D,bA as Z,bQ as qe,aK as Re,c as K,Z as ne,by as Ke,ac as W,bt as oe,q as Ge,C as ze,E as Ye,z as O,K as L,Y as j,bv as Ue,bC as U,a6 as ce,bR as be,ak as G,bS as Je,az as fe,bT as He,a3 as se,a8 as Y,bU as Se,a2 as Be,bo as H,bV as Xe,y as Ze,bW as Qe,D as et,F as tt,$ as le,ag as nt,r as we,ae as ie,bX as st,bY as me,bZ as Q,b_ as ae,b$ as ot,c0 as at,c1 as rt,n as ke,c2 as ct,c3 as lt,c4 as it,B as dt,bD as de,c5 as ut,c6 as ft,c7 as mt}from"./index.6ee6dd82.js";import{d as Ce}from"./index.042397f8.js";function pt(r,d){return r&&r.length?je(r,$e(d)):[]}const ue=De;function ht(r,d){return B(()=>{const a=e(r),{labelCol:b={},wrapperCol:p={}}=a.formItemProps||{},{labelWidth:y,disabledLabelWidth:w}=a,{labelWidth:u,labelCol:R,wrapperCol:P}=e(d);if(!u&&!y&&!R||w)return b.style={textAlign:"left"},{labelCol:b,wrapperCol:p};let h=y||u;const C=A(A({},R),b),T=A(A({},P),p);return h&&(h=pe(h)?`${h}px`:h),{labelCol:A({style:{width:h}},C),wrapperCol:A({style:{width:`calc(100% - ${h})`}},T)}})}function Fe(r,d=""){const{t:a}=he();if(r.includes("Input")||r.includes("Complete"))return`${a("common.inputText")}${d}`;const b=["Select","Cascader","Checkbox","CheckboxGroup","Switch","TreeSelect"];return r.includes("Picker")||b.includes(r)?`${a("common.chooseText")}${d}`:""}const bt=["DatePicker","MonthPicker","WeekPicker","TimePicker"];function yt(){return[...bt,"RangePicker"]}function gt(r,d){return r&&["Input","InputPassword","InputSearch","InputTextArea"].includes(r)&&d&&pe(d)?`${d}`:d}const vt=yt(),xe=Symbol("schema-form");function At(r){return V(this,null,function*(){Ee(xe,r)})}function Ie(){return _e(xe)}const Rt={name:"SchemaFormItem"};var wt=re(J(A({},Rt),{props:{formModel:{type:Object,default:()=>({})},schema:{type:Object,default:()=>({})},setFormModel:{type:Function,default:null},tableInstance:{type:Object},setItemRef:{type:Function,default:()=>({})}},emits:["update:formModel"],setup(r,{emit:d}){const a=r,b=Ie(),{formPropsRef:p}=b,y=We(a,"formModel",d),{t:w}=he(),{schema:u}=Ne(a),R=ht(u,p),P=B(()=>{const{component:n,componentProps:o}=u.value;return!q(o)&&(o==null?void 0:o.vModelKey)?o.vModelKey:D(n)&&["Switch","Checkbox"].includes(n)?"checked":"value"}),h=B(()=>{const{formModel:n,schema:o,tableInstance:t}=a,{mergeDynamicData:s}=e(p);return{field:o.field,formInstance:b,tableInstance:t,formModel:n,values:A(A({},s),n),schema:o}}),C=B(()=>{const{vShow:n,vIf:o,isAdvanced:t=!1}=e(u),{showAdvancedButton:s}=e(p),f=s&&Z(t)?t:!0;let l=!0,i=!0;return Z(n)&&(l=n),Z(o)&&(i=o),q(n)&&(l=n(e(h))),q(o)&&(i=o(e(h))),l=l&&f,{isShow:l,isIfShow:i}}),T=B(()=>{const{disabled:n}=e(p),{dynamicDisabled:o}=a.schema,{disabled:t=!1}=e(g);let s=!!n||t;return Z(o)&&(s=o),q(o)&&(s=o(e(h))),s}),k=(n,o=e(h))=>{if(D(n))return K(Be,null,[n]);if(Re(n))return n;if(q(n))return k(n(o));if(H(n)){const t=Object.keys(n);return t.some(s=>s.startsWith("_")||["setup","render"].includes(s))?n:t.reduce((s,f)=>(s[f]=(...l)=>k(n[f],l),s),{})}return n},c=B(()=>{var o;const n=a.schema.component;return D(n)&&(o=qe[n])!=null?o:k(n)}),m=B(()=>{var o;const n=(o=a.schema.componentSlots)!=null?o:{};return D(n)||Re(n)?{default:(...t)=>k(n,t)}:k(n)}),g=B(()=>{var f,l;const{schema:n}=a;let{componentProps:o={},component:t,label:s=""}=n;return q(o)&&(o=(f=o(e(h)))!=null?f:{}),t!=="RangePicker"&&D(t)&&((l=o.placeholder)!=null||(o.placeholder=Fe(t,s))),n.component==="Divider"&&(o=Object.assign({type:"horizontal"},o,{orientation:"left",plain:!0})),n.field,o}),F=B(()=>{var o;const n=((o=a.schema)==null?void 0:o.componentProps)||{};return Object.keys(n).reduce((t,s)=>{if(/on([A-Z])/.test(s)){const f=s.replace(/on([A-Z])/,"$1").toLocaleLowerCase();t[f]=n[s]}return t},{})}),S=B(()=>{const{label:n,helpMessage:o,helpComponentProps:t,subLabel:s}=a.schema,f=s?K("span",null,[n,ne(" "),K("span",{class:"text-secondary"},[s])]):k(n),l=q(o)?o(e(h)):o;return!l||Array.isArray(l)&&l.length===0?f:K("span",null,[f,K(Ke,W({placement:"top",class:"mx-1",text:l},t),null)])});function v(n,o,t){["DatePicker","MonthPicker","WeekPicker","TimePicker"].includes(o)?n.type=t?"string":"object":["RangePicker","Upload","CheckboxGroup","TimePicker"].includes(o)?n.type="array":["InputNumber"].includes(o)&&(n.type="number")}const x=B(()=>{var ge;const{rules:n=[],component:o,rulesMessageJoinLabel:t,label:s,dynamicRules:f,required:l}=a.schema;if(q(f))return f(e(h));let i=oe(n);const{rulesMessageJoinLabel:I}=e(p),_=Reflect.has(e(p),"rulesMessageJoinLabel")?t:I,ee=D(o)?`${Fe(o,s)}${_?s:""}`:void 0;function N($,M){const te=$.message||ee;return M===void 0||Xe(M)||Array.isArray(M)&&M.length===0||typeof M=="string"&&M.trim()===""||typeof M=="object"&&Reflect.has(M,"checked")&&Reflect.has(M,"halfChecked")&&Array.isArray(M.checked)&&Array.isArray(M.halfChecked)&&M.checked.length===0&&M.halfChecked.length===0?Promise.reject(te):Promise.resolve()}const E=q(l)?l(e(h)):l;(!i||i.length===0)&&E&&(i=[{required:E,validator:N}]);const ye=i.findIndex($=>Reflect.has($,"required")&&!Reflect.has($,"validator"));if(ye!==-1){const $=i[ye];if(o&&D(o)){Reflect.has($,"type")||($.type=o==="InputNumber"?"number":"string"),$.message=$.message||ee,(o.includes("Input")||o.includes("Textarea"))&&($.whitespace=!0);const M=(ge=e(g))==null?void 0:ge.valueFormat;v($,o,M)}}const X=i.findIndex($=>$.max);return X!==-1&&!i[X].validator&&(i[X].message=i[X].message||w("component.form.maxTip",[i[X].max])),i});return Ge(()=>V(this,null,function*(){var n,o;if((n=g.value)!=null&&n.request){const t=g.value,{componentProps:s,component:f}=u.value;u.value.loading=!0,u.value.field==="field35"&&p.value;try{const l=yield(o=g.value)==null?void 0:o.request(e(h));["Select","RadioGroup","CheckBoxGroup"].some(i=>i===f)?t.options=l:["TreeSelect","Tree"].some(i=>i===f)&&(t.treeData=l),s&&(s.requestResult=l)}finally{u.value.loading=!1}}})),(n,o)=>e(C).isIfShow?ze((O(),L(e(Se),U(W({key:0},e(u).colProps)),{default:j(()=>[e(u).component==="Divider"?(O(),L(e(Ue),U(W({key:0},e(g))),{default:j(()=>[(O(),L(ce(e(S))))]),_:1},16)):(O(),L(e(be).Item,W({key:1},A({},e(u).formItemProps),{label:e(S),name:e(u).field,"label-col":e(R).labelCol,"wrapper-col":e(R).wrapperCol,rules:e(x)}),{default:j(()=>[e(u).slot?G(n.$slots,e(u).slot,U(W({key:0},e(h)))):e(c)?(O(),L(ce(e(c)),W({key:1,ref:r.setItemRef,key:e(u).field},e(g),{[e(P)]:e(y)[e(u).field],["onUpdate:"+e(P)]:o[0]||(o[0]=t=>e(y)[e(u).field]=t),"allow-clear":!0,disabled:e(T)},Je(e(F))),fe({_:2},[Object.is(e(u).loading,!0)?{name:"notFoundContent",fn:j(()=>[K(e(He),{size:"small"})])}:void 0,se(e(m),(t,s)=>({name:s,fn:j(f=>{var l;return[(O(),L(ce((l=t==null?void 0:t(J(A({},e(h)),{slotData:f})))!=null?l:t),{key:s}))]})}))]),1040,["disabled"])):Y("",!0)]),_:3},16,["label","name","label-col","wrapper-col","rules"]))]),_:3},16)),[[Ye,e(C).isShow]]):Y("",!0)}}));const Ft=re({props:{expand:{type:Boolean}},setup(r){const d=r;Qe(b=>({"3cc09834":e(a)}));const a=B(()=>`${d.expand?0:.5}turn`);return(b,p)=>(O(),L(e(et),{class:"collapse-icon"}))}});var Pt=Ze(Ft,[["__scopeId","data-v-623bf38a"]]);const St={name:"FormAction",inheritAttrs:!1},Bt=re(J(A({},St),{props:{showActionButtonGroup:{type:Boolean,default:!0},showResetButton:{type:Boolean,default:!0},showSubmitButton:{type:Boolean,default:!0},showAdvancedButton:{type:Boolean,default:!0},resetButtonOptions:{type:Object,default:()=>({})},submitButtonOptions:{type:Object,default:()=>({})},actionColOptions:{type:Object,default:()=>({})},actionSpan:{type:Number,default:6},isAdvanced:Boolean,hideAdvanceBtn:Boolean},emits:["toggle-advanced"],setup(r,{emit:d}){const a=r,{t:b}=he(),{resetFields:p,submit:y}=Ie(),w=B(()=>{const{showAdvancedButton:h,actionSpan:C,actionColOptions:T}=a,k=24-C,c=h?{span:k<6?24:k}:{};return A(A({style:{textAlign:"right"},span:h?6:4},c),T)}),u=B(()=>Object.assign({text:b("common.resetText")},a.resetButtonOptions)),R=B(()=>Object.assign({text:b("common.queryText")},a.submitButtonOptions));function P(){d("toggle-advanced",a.isAdvanced)}return(h,C)=>r.showActionButtonGroup?(O(),L(e(Se),U(W({key:0},e(w))),{default:j(()=>[tt("div",{style:nt([{width:"100%"},{textAlign:e(w).style.textAlign}])},[K(e(be).Item,null,{default:j(()=>[G(h.$slots,"resetBefore"),r.showResetButton?(O(),L(e(ue),W({key:0,type:"default",class:"mr-2"},e(u),{onClick:e(p)}),{default:j(()=>[ne(le(e(u).text),1)]),_:1},16,["onClick"])):Y("",!0),G(h.$slots,"submitBefore"),r.showSubmitButton?(O(),L(e(ue),W({key:1,type:"primary",class:"mr-2"},e(R),{onClick:e(y)}),{default:j(()=>[ne(le(e(R).text),1)]),_:1},16,["onClick"])):Y("",!0),G(h.$slots,"advanceBefore"),r.showAdvancedButton&&!r.hideAdvanceBtn?(O(),L(e(ue),{key:2,type:"link",size:"small",onClick:P},{default:j(()=>[ne(le(r.isAdvanced?e(b)("component.form.putAway"):e(b)("component.form.unfold"))+" ",1),K(e(Pt),{class:"ml-1",expand:!r.isAdvanced},null,8,["expand"])]),_:1})):Y("",!0),G(h.$slots,"advanceAfter")]),_:3})],4)]),_:3},16)):Y("",!0)}})),kt=({props:r,attrs:d})=>{const a=we(oe(r)),b=ie(A({},r.initialValues)),p=ie(A({},r.initialValues)),y=we(),w=A({},r.initialValues),u={},R=ie({isAdvanced:!0,hideAdvanceBtn:!1,isLoad:!1,actionSpan:6}),P=B(()=>A(A({},d),a.value)),h=B(()=>{const{baseRowStyle:T={},rowProps:k}=e(P);return A({style:T},k)}),C=B(()=>A(A({},P.value),R));return{formModel:b,defaultFormValues:p,schemaFormRef:y,formPropsRef:a,cacheFormModel:w,compRefs:u,getFormProps:P,advanceState:R,getRowConfig:h,getFormActionBindProps:C,formSchemasRef:B(()=>e(a).schemas||[])}};function Ct(r){const{emit:d,formPropsRef:a,formSchemasRef:b,formModel:p,cacheFormModel:y,getFormProps:w,schemaFormRef:u,defaultFormValues:R,handleFormValues:P}=r;function h(){return e(u)?P(st(e(p))):{}}function C(t){var s;return(s=e(a).schemas)==null?void 0:s.some(f=>f.field===t&&D(f.component)?vt.includes(f.component):!1)}function T(t){return V(this,null,function*(){const s=e(b),f=s.map(i=>i.field).filter(Boolean);Object.assign(y,t);const l=[];Object.keys(t).forEach(i=>{const I=s.find(N=>N.field===i);let _=t[i];const ee=Reflect.has(t,i);if(D(I==null?void 0:I.component)&&(_=gt(I==null?void 0:I.component,_)),ee&&f.includes(i)){if(C(i))if(Array.isArray(_)){const N=[];for(const E of _)N.push(E?me(E):null);p[i]=N}else{const{componentProps:N}=I||{};let E=N;Q(N)&&(E=E({formPropsRef:a,formModel:p})),p[i]=_?E!=null&&E.valueFormat?_:me(_):null}else p[i]=_;l.push(i)}}),S(l)})}function k(t){return V(this,null,function*(){let s=[];H(t)&&s.push(t),ae(t)&&(s=[...t]),e(a).schemas=s})}function c(t,s,f=!1){return V(this,null,function*(){const l=oe(e(b)),i=l.findIndex(I=>I.field===s);if(!s||i===-1||f){f?l.unshift(t):l.push(t),p[t.field]=t.defaultValue,a.value.schemas=l;return}i!==-1&&l.splice(i+1,0,t),p[t.field]=t.defaultValue,a.value.schemas=l})}function m(t){return V(this,null,function*(){const s=oe(e(b));if(!t)return;let f=D(t)?[t]:t;D(t)&&(f=[t]);for(const l of f)if(D(l)){const i=s.findIndex(I=>I.field===l);i!==-1&&(Reflect.deleteProperty(p,l),s.splice(i,1))}a.value.schemas=s})}function g(t){return V(this,null,function*(){let s=[];if(H(t)&&s.push(t),ae(t)&&(s=[...t]),!s.every(i=>i.component==="Divider"||Reflect.has(i,"field")&&i.field)){console.error("All children of the form Schema array that need to be updated must contain the `field` field");return}const l=[];s.forEach(i=>{e(b).forEach(I=>{if(I.field===i.field){const _=Ce(I,i);l.push(_)}else l.push(I)})}),e(a).schemas=pt(l,"field")})}function F(){return V(this,null,function*(){const{resetFunc:t,submitOnReset:s}=e(w);t&&Q(t)&&(yield t()),Object.keys(p).forEach(f=>{p[f]=R[f]}),d("reset",p),s&&o(),setTimeout(x)})}function S(t){return V(this,null,function*(){var s;return(s=u.value)==null?void 0:s.validateFields(t)})}function v(t){return V(this,null,function*(){var s;return yield(s=u.value)==null?void 0:s.validate(t)})}function x(t){return V(this,null,function*(){var s;yield(s=u.value)==null?void 0:s.clearValidate(t)})}function n(t,s){return V(this,null,function*(){var f;yield(f=u.value)==null?void 0:f.scrollToField(t,s)})}function o(t){return V(this,null,function*(){t&&t.preventDefault();const{submitFunc:s}=e(w);if(s&&Q(s)){yield s();return}if(!!e(u))try{const l=yield v(),i=P(l);d("submit",i)}catch(l){return Promise.reject(l)}})}return{submit:o,clearValidate:x,validate:v,validateFields:S,getFieldsValue:h,updateSchema:g,resetSchema:k,appendSchemaByField:c,removeSchemaByFiled:m,resetFields:F,setFieldsValue:T,scrollToField:n}}const Pe=me,xt=r=>{const{compRefs:d,formModel:a,formPropsRef:b,cacheFormModel:p,defaultFormValues:y,schemaFormRef:w,getFormProps:u}=r,R=c=>m=>{m&&(d[c.field]=m)},P=(c,m)=>{var F;a[c]=m,p[c]=m;const{validateTrigger:g}=e(u);(!g||g==="change")&&((F=w.value)==null||F.validateFields([c]))},h=c=>{b.value=Ce(e(b)||{},c)};function C(c){var g,F;if(!H(c))return{};const m={};for(const S of Object.entries(c)){let[,v]=S;const[x]=S;if(!x||ae(v)&&v.length===0||Q(v))continue;const n=e(u).transformDateFunc;H(v)&&(v=n==null?void 0:n(v)),ae(v)&&((g=v[0])==null?void 0:g.format)&&((F=v[1])==null?void 0:F.format)&&(v=v.map(o=>n==null?void 0:n(o))),D(v)&&(v=v.trim()),ot(m,x,v)}return T(m)}function T(c){const m=e(u).fieldMapToTime;if(!m||!Array.isArray(m))return c;for(const[g,[F,S],v="YYYY-MM-DD"]of m){if(!g||!F||!S||!c[g])continue;const[x,n]=c[g];c[F]=Pe(x).format(v),c[S]=Pe(n).format(v),Reflect.deleteProperty(c,g)}return c}return{setItemRef:R,initFormValues:()=>{var c;(c=e(b).schemas)==null||c.forEach(m=>{const{defaultValue:g}=m;at(g)||(a[m.field]=g,y[m.field]=g,p[m.field]=g)})},setFormModel:P,setSchemaFormProps:h,handleFormValues:C}};let It,Tt,Mt;function Ot(){return{screenRef:B(()=>e(It)),widthRef:Tt,screenEnum:rt,realWidthRef:Mt}}const z=24,Vt=({instance:r,emit:d})=>{const{realWidthRef:a,screenEnum:b,screenRef:p}=Ot(),{advanceState:y,getFormProps:w,formSchemasRef:u,formModel:R,defaultFormValues:P}=r,h=B(()=>{if(!y.isAdvanced)return 0;const c=e(w).emptySpan||0;if(pe(c))return c;if(H(c)){const{span:m=0}=c,g=e(p);return c[g.toLowerCase()]||m||0}return 0});ke([()=>e(u),()=>y.isAdvanced,()=>e(a)],()=>{const{showAdvancedButton:c}=e(w);c&&T()},{immediate:!0});function C(c,m=0,g=!1){const F=e(a),S=parseInt(c.md)||parseInt(c.xs)||parseInt(c.sm)||c.span||z,v=parseInt(c.lg)||S,x=parseInt(c.xl)||v,n=parseInt(c.xxl)||x;return F<=b.LG?m+=S:F<b.XL?m+=v:F<b.XXL?m+=x:m+=n,g?(y.hideAdvanceBtn=!1,m<=z*2?(y.hideAdvanceBtn=!0,y.isAdvanced=!0):m>z*2&&m<=z*(e(w).autoAdvancedLine||3)?y.hideAdvanceBtn=!1:y.isLoad||(y.isLoad=!0,y.isAdvanced=!y.isAdvanced),{isAdvanced:y.isAdvanced,itemColSum:m}):m>z*(e(w).alwaysShowLines||1)?{isAdvanced:y.isAdvanced,itemColSum:m}:{isAdvanced:!0,itemColSum:m}}function T(){let c=0,m=0;const{baseColProps:g={}}=e(w);for(const F of e(u)){const{vShow:S,colProps:v}=F;let x=!0;if(Z(S)&&(x=S),Q(S)&&(x=S({schema:F,formModel:R,field:F.field,formInstance:r,values:A(A({},e(P)),R)})),x&&(v||g)){const{itemColSum:n,isAdvanced:o}=C(A(A({},g),v),c);c=n||0,o&&(m=c),F.isAdvanced=o}}y.actionSpan=m%z+e(h),C(e(w).actionColOptions||{span:z},c,!0),d("advanced-change")}function k(){y.isAdvanced=!y.isAdvanced}return{handleToggleAdvanced:k}},Lt={name:"SchemaForm"},_t=re(J(A({},Lt),{props:ct,emits:lt,setup(r,{expose:d,emit:a}){const b=r,p=it(),y=kt({props:b,attrs:p}),{formModel:w,getRowConfig:u,schemaFormRef:R,getFormProps:P,getFormActionBindProps:h,formSchemasRef:C}=y,T=xt(A({},y)),{initFormValues:k,handleFormValues:c,setFormModel:m,setItemRef:g,setSchemaFormProps:F}=T;k();const S=Ct(J(A({},y),{emit:a,handleFormValues:c}));ke(b,()=>F(b),{deep:!0,immediate:!0});const v=A(A(A({},y),S),T),{handleToggleAdvanced:x}=Vt({instance:v,emit:a});return a("register",v),At(v),d(v),(n,o)=>(O(),L(e(be),W({ref_key:"schemaFormRef",ref:R},e(ft)(e(P),e(mt)),{model:e(w)}),{default:j(()=>[K(e(ut),U(de(e(u))),{default:j(()=>[G(n.$slots,"formHeader"),(O(!0),dt(Be,null,se(e(C),t=>(O(),L(wt,{key:t.field,schema:t,"set-form-model":e(m),"form-model":e(w),"table-instance":n.tableInstance,"set-item-ref":e(g)(t)},fe({_:2},[se(Object.keys(n.$slots),s=>({name:s,fn:j(f=>[G(n.$slots,s,U(de(f||{})))])}))]),1032,["schema","set-form-model","form-model","table-instance","set-item-ref"]))),128)),n.showActionButtonGroup?(O(),L(Bt,W({key:0},e(h),{onToggleAdvanced:e(x)}),fe({_:2},[se(["resetBefore","submitBefore","advanceBefore","advanceAfter"],t=>({name:t,fn:j(s=>[G(n.$slots,t,U(de(s||{})))])}))]),1040,["onToggleAdvanced"])):Y("",!0),G(n.$slots,"formFooter")]),_:3},16)]),_:3},16,["model"]))}}));export{_t as _,Pe as d};
